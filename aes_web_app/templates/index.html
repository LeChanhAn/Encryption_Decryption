<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AES-128 Pure Python Demo</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>üõ°Ô∏è AES-128 Simulation</h1>
            <p>M√¥ ph·ªèng thu·∫≠t to√°n AES Pure Python (CBC & CFB)</p>
        </header>

        {% if error %}
        <div class="alert error">
            ‚ö†Ô∏è <strong>L·ªói:</strong> {{ error }}
        </div>
        {% endif %}

        <form method="POST" action="/">
            <div class="grid-layout">
                <div class="card input-section">
                    <h2>üì• D·ªØ li·ªáu ƒë·∫ßu v√†o</h2>
                    
                    <div class="form-group">
                        <label>H√†nh ƒë·ªông:</label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="action" value="encrypt" onclick="toggleIV(this.value)" 
                                {{ 'checked' if form.action == 'encrypt' else '' }}> 
                                üîí M√£ h√≥a (Encrypt)
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="action" value="decrypt" onclick="toggleIV(this.value)"
                                {{ 'checked' if form.action == 'decrypt' else '' }}> 
                                üîì Gi·∫£i m√£ (Decrypt)
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="mode">Ch·∫ø ƒë·ªô (Mode):</label>
                        <select name="mode" id="mode">
                            <option value="cbc" {{ 'selected' if form.mode == 'cbc' else '' }}>CBC (Cipher Block Chaining)</option>
                            <option value="cfb" {{ 'selected' if form.mode == 'cfb' else '' }}>CFB (Cipher Feedback)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="key">Kh√≥a b√≠ m·∫≠t (Key):</label>
                        <input type="text" name="key" id="key" maxlength="32" 
                               placeholder="VD: 32 k√Ω t·ª± Hex ho·∫∑c 16 k√Ω t·ª± Text" 
                               value="{{ form.key }}" required 
                               style="font-family: monospace;">
                        <small>Nh·∫≠p 32 k√Ω t·ª± HEX (v√≠ d·ª•: 2b7e...) ho·∫∑c 16 k√Ω t·ª± vƒÉn b·∫£n.</small>
                    </div>

                    <div class="form-group" id="iv-group" style="display: none;">
                        <label for="iv">Initialization Vector (IV - Hex):</label>
                        <input type="text" name="iv" id="iv" 
                               placeholder="Nh·∫≠p chu·ªói IV hex (32 k√Ω t·ª±)..." 
                               value="{{ form.iv }}"
                               style="font-family: monospace;">
                    </div>

                    <div class="form-group">
                        <label id="input-label">N·ªôi dung (Plaintext):</label>
                        <textarea name="input_text" rows="5" placeholder="Nh·∫≠p n·ªôi dung..." required>{{ form.input_text }}</textarea>
                    </div>

                    <button type="submit" class="btn-submit">üöÄ Th·ª±c hi·ªán</button>
                </div>

                <div class="card output-section">
                    <h2>üì§ K·∫øt qu·∫£</h2>
                    
                    {% if result %}
                    <div class="result-box">
                        {% if iv_result %}
                        <div class="field">
                            <span class="label">IV (Hex) ƒë∆∞·ª£c sinh ra:</span>
                            <div class="code-block" style="font-family: monospace;">{{ iv_result }}</div>
                        </div>
                        {% endif %}

                        <div class="field">
                            <span class="label">Output:</span>
                            <div class="code-block main-result" style="white-space: pre-wrap; word-break: break-all;">{{ result }}</div>
                        </div>
                    </div>
                    {% else %}
                    <div class="placeholder-text">K·∫øt qu·∫£ s·∫Ω hi·ªÉn th·ªã t·∫°i ƒë√¢y...</div>
                    {% endif %}
                </div>
            </div>
        </form>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <script>
        // Ch·∫°y ngay khi load trang ƒë·ªÉ set ƒë√∫ng tr·∫°ng th√°i ·∫©n hi·ªán IV
        toggleIV("{{ form.action }}");
    </script>
</body>
</html>